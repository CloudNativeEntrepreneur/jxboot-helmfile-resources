# Source: jxboot-helmfile-resources/templates/jx-meta-pipeline-2.yaml
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  creationTimestamp: "2020-09-21T18:36:47Z"
  generation: 1
  labels:
    branch: PR-1
    build: "1"
    context: pr-build
    jenkins.io/pipelineType: meta
    owner: cb-kubecd
    repository: bdd-gh-1600712365
  name: meta-cb-kubecd-bdd-gh-160071236-xq2hg-1
  namespace: jx
  ownerReferences:
  - apiVersion: jenkins.io/v1
    kind: PipelineActivity
    name: cb-kubecd-bdd-gh-1600712365-pr-1-1
    uid: 272cc3ea-19af-40f4-be50-8cf45ecc3f61
  resourceVersion: "13063"
  selfLink: /apis/tekton.dev/v1beta1/namespaces/jx/pipelines/meta-cb-kubecd-bdd-gh-160071236-xq2hg-1
  uid: 041e4a39-424e-4256-8bbd-7bb941b8dd5e
spec:
  params:
  - default: 0.0.1
    description: the version number for this pipeline which is used as a tag on docker images and helm charts
    name: version
    type: string
  - description: git url to clone
    name: REPO_URL
    type: string
  - default: master
    description: git revision to checkout (branch, tag, sha, refâ€¦)
    name: revision
    type: string
  - default: source
    description: subdirectory inside of /workspace to clone the git repo
    name: subdirectory
    type: string
  tasks:
  - name: meta-pipeline
    resources:
      inputs:
      - name: workspace
        resource: meta-cb-kubecd-bdd-gh-160071236-xq2hg
    taskSpec:
      stepTemplate:
        resources:
          requests:
            cpu: 400m
            memory: 512Mi
        volumeMounts:
        - mountPath: /home/jenkins
          name: workspace-volume
        - mountPath: /etc/podinfo
          name: podinfo
          readOnly: true
        workingDir: /workspace/source
      steps:
      - args:
        - '[ -d /builder/home ] || mkdir -p /builder && ln -s /tekton/home /builder/home'
        command:
        - /bin/sh
        - -c
        env:
        - name: APP_NAME
          value: bdd-gh-1600712365
        - name: BRANCH_NAME
          value: PR-1
        - name: BUILD_NUMBER
          value: "1"
        - name: JOB_NAME
          value: cb-kubecd/bdd-gh-1600712365/PR-1
        - name: JOB_SPEC
          value: type:presubmit
        - name: JOB_TYPE
          value: presubmit
        - name: PIPELINE_CONTEXT
          value: pr-build
        - name: PIPELINE_KIND
          value: pullrequest
        - name: PULL_BASE_REF
          value: master
        - name: PULL_BASE_SHA
          value: ecf3d089046eaec92e4a00ba23ec66d75076384e
        - name: PULL_NUMBER
          value: "1"
        - name: PULL_PULL_SHA
          value: 766f956474495dd7b632e33faf3e58b314a77ddf
        - name: PULL_REFS
          value: master:ecf3d089046eaec92e4a00ba23ec66d75076384e,1:766f956474495dd7b632e33faf3e58b314a77ddf
        - name: REPO_NAME
          value: bdd-gh-1600712365
        - name: REPO_OWNER
          value: cb-kubecd
        - name: SOURCE_URL
          value: https://github.com/cb-kubecd/bdd-gh-1600712365.git
        image: gcr.io/jenkinsxio/builder-maven:2.1.142-761
        name: setup-builder-home
        resources:
          limits:
            cpu: 800m
            memory: 512Mi
          requests:
            cpu: 400m
            memory: 256Mi
        volumeMounts:
        - mountPath: /root/.m2/
          name: jenkins-maven-settings
        workingDir: /workspace/source
      - args:
        - step
        - git
        - merge
        - --verbose
        command:
        - jx
        env:
        - name: APP_NAME
          value: bdd-gh-1600712365
        - name: BRANCH_NAME
          value: PR-1
        - name: BUILD_NUMBER
          value: "1"
        - name: JOB_NAME
          value: cb-kubecd/bdd-gh-1600712365/PR-1
        - name: JOB_SPEC
          value: type:presubmit
        - name: JOB_TYPE
          value: presubmit
        - name: PIPELINE_CONTEXT
          value: pr-build
        - name: PIPELINE_KIND
          value: pullrequest
        - name: PULL_BASE_REF
          value: master
        - name: PULL_BASE_SHA
          value: ecf3d089046eaec92e4a00ba23ec66d75076384e
        - name: PULL_NUMBER
          value: "1"
        - name: PULL_PULL_SHA
          value: 766f956474495dd7b632e33faf3e58b314a77ddf
        - name: PULL_REFS
          value: master:ecf3d089046eaec92e4a00ba23ec66d75076384e,1:766f956474495dd7b632e33faf3e58b314a77ddf
        - name: REPO_NAME
          value: bdd-gh-1600712365
        - name: REPO_OWNER
          value: cb-kubecd
        - name: SOURCE_URL
          value: https://github.com/cb-kubecd/bdd-gh-1600712365.git
        image: gcr.io/jenkinsxio/builder-maven:2.1.142-761
        name: git-merge
        resources:
          limits:
            cpu: 800m
            memory: 512Mi
          requests:
            cpu: 400m
            memory: 256Mi
        volumeMounts:
        - mountPath: /root/.m2/
          name: jenkins-maven-settings
        workingDir: /workspace/source
      - args:
        - jx step git merge --verbose --baseBranch master --baseSHA ecf3d089046eaec92e4a00ba23ec66d75076384e
          --sha 766f956474495dd7b632e33faf3e58b314a77ddf
        command:
        - /bin/sh
        - -c
        env:
        - name: APP_NAME
          value: bdd-gh-1600712365
        - name: BRANCH_NAME
          value: PR-1
        - name: BUILD_NUMBER
          value: "1"
        - name: JOB_NAME
          value: cb-kubecd/bdd-gh-1600712365/PR-1
        - name: JOB_SPEC
          value: type:presubmit
        - name: JOB_TYPE
          value: presubmit
        - name: PIPELINE_CONTEXT
          value: pr-build
        - name: PIPELINE_KIND
          value: pullrequest
        - name: PULL_BASE_REF
          value: master
        - name: PULL_BASE_SHA
          value: ecf3d089046eaec92e4a00ba23ec66d75076384e
        - name: PULL_NUMBER
          value: "1"
        - name: PULL_PULL_SHA
          value: 766f956474495dd7b632e33faf3e58b314a77ddf
        - name: PULL_REFS
          value: master:ecf3d089046eaec92e4a00ba23ec66d75076384e,1:766f956474495dd7b632e33faf3e58b314a77ddf
        - name: REPO_NAME
          value: bdd-gh-1600712365
        - name: REPO_OWNER
          value: cb-kubecd
        - name: SOURCE_URL
          value: https://github.com/cb-kubecd/bdd-gh-1600712365.git
        image: gcr.io/jenkinsxio/builder-maven:2.1.142-761
        name: merge-pull-refs
        resources:
          limits:
            cpu: 800m
            memory: 512Mi
          requests:
            cpu: 400m
            memory: 256Mi
        volumeMounts:
        - mountPath: /root/.m2/
          name: jenkins-maven-settings
        workingDir: /workspace/source
      - args:
        - jx step syntax effective --output-dir . --context pr-build --env BUILD_NUMBER=1
          --env PIPELINE_KIND=pullrequest --env PULL_REFS=master:ecf3d089046eaec92e4a00ba23ec66d75076384e,1:766f956474495dd7b632e33faf3e58b314a77ddf
          --env PIPELINE_CONTEXT=pr-build --env SOURCE_URL=https://github.com/cb-kubecd/bdd-gh-1600712365.git
          --env REPO_OWNER=cb-kubecd --env REPO_NAME=bdd-gh-1600712365 --env APP_NAME=bdd-gh-1600712365
          --env BRANCH_NAME=PR-1 --env JOB_NAME=cb-kubecd/bdd-gh-1600712365/PR-1 --env
          JOB_TYPE=presubmit --env JOB_SPEC=type:presubmit --env PULL_BASE_REF=master
          --env PULL_BASE_SHA=ecf3d089046eaec92e4a00ba23ec66d75076384e --env PULL_NUMBER=1
          --env PULL_PULL_SHA=766f956474495dd7b632e33faf3e58b314a77ddf
        command:
        - /bin/sh
        - -c
        env:
        - name: APP_NAME
          value: bdd-gh-1600712365
        - name: BRANCH_NAME
          value: PR-1
        - name: BUILD_NUMBER
          value: "1"
        - name: JOB_NAME
          value: cb-kubecd/bdd-gh-1600712365/PR-1
        - name: JOB_SPEC
          value: type:presubmit
        - name: JOB_TYPE
          value: presubmit
        - name: PIPELINE_CONTEXT
          value: pr-build
        - name: PIPELINE_KIND
          value: pullrequest
        - name: PULL_BASE_REF
          value: master
        - name: PULL_BASE_SHA
          value: ecf3d089046eaec92e4a00ba23ec66d75076384e
        - name: PULL_NUMBER
          value: "1"
        - name: PULL_PULL_SHA
          value: 766f956474495dd7b632e33faf3e58b314a77ddf
        - name: PULL_REFS
          value: master:ecf3d089046eaec92e4a00ba23ec66d75076384e,1:766f956474495dd7b632e33faf3e58b314a77ddf
        - name: REPO_NAME
          value: bdd-gh-1600712365
        - name: REPO_OWNER
          value: cb-kubecd
        - name: SOURCE_URL
          value: https://github.com/cb-kubecd/bdd-gh-1600712365.git
        image: gcr.io/jenkinsxio/builder-maven:2.1.142-761
        name: create-effective-pipeline
        resources:
          limits:
            cpu: 800m
            memory: 512Mi
          requests:
            cpu: 400m
            memory: 256Mi
        volumeMounts:
        - mountPath: /root/.m2/
          name: jenkins-maven-settings
        workingDir: /workspace/source
      - args:
        - jx step create task --clone-dir /workspace/source --kind pullrequest --pr-number
          1 --service-account tekton-bot --source source --branch PR-1 --build-number
          1 --context pr-build
        command:
        - /bin/sh
        - -c
        env:
        - name: APP_NAME
          value: bdd-gh-1600712365
        - name: BRANCH_NAME
          value: PR-1
        - name: BUILD_NUMBER
          value: "1"
        - name: JOB_NAME
          value: cb-kubecd/bdd-gh-1600712365/PR-1
        - name: JOB_SPEC
          value: type:presubmit
        - name: JOB_TYPE
          value: presubmit
        - name: PIPELINE_CONTEXT
          value: pr-build
        - name: PIPELINE_KIND
          value: pullrequest
        - name: PULL_BASE_REF
          value: master
        - name: PULL_BASE_SHA
          value: ecf3d089046eaec92e4a00ba23ec66d75076384e
        - name: PULL_NUMBER
          value: "1"
        - name: PULL_PULL_SHA
          value: 766f956474495dd7b632e33faf3e58b314a77ddf
        - name: PULL_REFS
          value: master:ecf3d089046eaec92e4a00ba23ec66d75076384e,1:766f956474495dd7b632e33faf3e58b314a77ddf
        - name: REPO_NAME
          value: bdd-gh-1600712365
        - name: REPO_OWNER
          value: cb-kubecd
        - name: SOURCE_URL
          value: https://github.com/cb-kubecd/bdd-gh-1600712365.git
        image: gcr.io/jenkinsxio/builder-maven:2.1.142-761
        name: create-tekton-crds
        resources:
          limits:
            cpu: 800m
            memory: 512Mi
          requests:
            cpu: 400m
            memory: 256Mi
        volumeMounts:
        - mountPath: /root/.m2/
          name: jenkins-maven-settings
        workingDir: /workspace/source
      volumes:
      - name: jenkins-maven-settings
        secret:
          secretName: jenkins-maven-settings
